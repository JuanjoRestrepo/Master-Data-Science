---
title: "Actividad_03"
author: "Juan José Restrepo Rosero"
date: "`r format(Sys.Date(), '%d %B %Y')`"
output:
  html_document:
    toc: yes
    toc_float: yes
  pdf_document:
    latex_engine: xelatex
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(repos = c(CRAN = "https://cran.r-project.org"))
```


```{r cars, echo=FALSE, message=FALSE, warning=TRUE}

#install.packages("devtools") # solo una vez
#devtools::install_github("centromagis/paqueteMETODOS") 
library(paqueteMETODOS)
library('summarytools')
library(corrplot)
library(lmtest)
library(car)
library(gridExtra)
```


# **Definición del problema**
Con base en los datos de ofertas de vivienda descargadas del portal Fincaraiz para apartamento de estrato 4 con área construida menor a 200 m^2 (vivienda4.RDS) la inmobiliaria A&C requiere el apoyo de un científico de datos en la construcción de un modelo que lo oriente sobre los precios de inmuebles. <br> <br>Con este propósito el equipo de asesores a diseñado los siguientes pasos para obtener un modelo y así poder a futuro determinar los precios de los inmuebles a negociar.


## **1. Realice un análisis exploratorio de las variables precio de vivienda (millones de pesos COP) y área de la vivienda (metros cuadrados) - incluir gráficos e indicadores apropiados interpretados.**

### Cargamos las librerías necesarias para el análisis exploratorio
- ***library(ggplot2):*** Para graficar
- ***library(dplyr):*** Para manipulación de datos
- ***library(summarytools):*** Para resúmenes descriptivos


### Cargamos los datos del dataframe "vivienda4" si aún no se han cargado
```{r}
if (!exists("vivienda4")) {
  data(vivienda4)
}
```

Visualizamos el tipo de vivienda y la cantidad
```{r}
table (vivienda4$tipo)
```

```{r}
# 1. Validar datos faltantes por variable
missing_data <- sapply(vivienda4, function(x) sum(is.na(x)))
cat("Datos faltantes por variable:\n")
print(missing_data)
```

```{r}
# 2. Validar si existen datos vacíos o null dentro de las variables del dataframe
if (any(is.na(vivienda4))) {
  cat("El dataframe contiene valores nulos o vacíos.\n")
}
```

```{r}
# 3. Contar los valores duplicados y eliminarlos
duplicated_rows <- sum(duplicated(vivienda4))
cat("Número de filas duplicadas:", duplicated_rows, "\n")
```
```{r}
# 4. Eliminar filas duplicadas
vivienda4 <- unique(vivienda4)
```


```{r}
# 5. Correlación entre el precio y el área construída
cor(vivienda4$preciom, vivienda4$areaconst)
cor(vivienda4$preciom, vivienda4$areaconst, use = "complete.obs")
```


```{r}
# Dataframe final sin valores atípicos

# Se eliminarán las observaciones con valores de "preciom" cuya SD (Desviación Estándar) sea mayor a 3 unidades de la media

# Media y SD de la variable "preciom"
media_preciom <- mean(vivienda4$preciom)
desviacion_preciom <- sd(vivienda4$preciom)
```

```{r}
print(media_preciom)
print(desviacion_preciom)
```

```{r}
# Crear un vector lógico unidimensional para filtrar los outliers que vamos a eliminar
condicion_outliers <- abs((vivienda4$preciom - media_preciom) / desviacion_preciom) <= 3
```

```{r message=FALSE, warning=FALSE, include=FALSE}
cond_outliers2 = abs((vivienda4$preciom - media_preciom) / desviacion_preciom)
print(cond_outliers2)
```

```{r include=FALSE}
print(condicion_outliers)
```

```{r}
vivienda4 <- vivienda4 %>%
  filter(condicion_outliers)
print(vivienda4)
```
```{r message=TRUE, warning=TRUE, include=FALSE}
# Resumen descriptivo de las variables "preciom" y "areaconst"
desc_vars <- dfSummary(vivienda4[c("preciom", "areaconst")])
```

```{r}
# Correlación entre el precio y el área construída después de eliminar los outliers
cor(vivienda4$preciom, vivienda4$areaconst)
cor(vivienda4$preciom, vivienda4$areaconst, use = "complete.obs")
```

```{r}
# Gráfico de dispersión (preciom vs areaconst)
ggplot(vivienda4, aes(x = areaconst, y = preciom)) +
  geom_point() +
  geom_smooth(method = "lm", color = "red", se = FALSE) +  # Línea de tendencia
  labs(x = "Área Construida (m²)", y = "Precio (millones de pesos COP)") +
  ggtitle("Gráfica de Dispersión Precio vs Área Construida")
```


### 1.1 Análisis para Apartamentos

```{r}
aptos <- subset(vivienda4, vivienda4$tipo == "Apartamento")
summary(aptos)
```

Como podemos apreciar al ver el resumen del dataframe para los apartamentos, se destaca lo siguiente: 
- Los apartamentos de estrato 4 tienen un rango de precios que va desde $207.4 millones hasta $300.6 millones, con un precio promedio de $237.6 millones. 
- El 50% de estos apartamentos se encuentran en un rango de precios entre $228.8 y $243.6 millones.
- Un 25% de los apartamentos tiene un precio inferior a $228.8 millones, mientras que el otro 25% restante supera los $243.6 millones.
- En cuanto al área construida, las propiedades varían desde 40 m² hasta un máximo de 200 m², con un promedio de 75.3 m². La mitad de los apartamentos tiene un área construida que oscila entre 60 m² y 83 m². El 25% tiene menos de 60 m² y el 25% supera los 83 m².

```{r}
# Validar si existen valores atípicos en los apartamentos
par(mfrow = c(1, 2))
boxplot(aptos$preciom, main = "Precio de apartamentos", col = "cyan")
boxplot(aptos$areaconst, main = "Área construida de apartamentos", col ="green")
par(mfrow = c(1, 1))
```
Como se aprecia en el gráfico anterior, tanto el precio como el área construida muestran la presencia de valores atípicos, ya que hay puntos extremos (bigotes) que sobresalen por encima de la caja. Además, los precios presentan un nivel de simetría, dado que los datos están distribuidos de manera equilibrada alrededor de la mediana. 

En cuanto al área construida, se observa una ligera asimetría en los datos, con un sesgo leve hacia la parte inferior.


```{r}
par(mfrow = c(1, 2))

# Histograma del precio
hist(aptos$preciom, main = "Histograma de precio", xlab = "Precio", col = "cyan")

# Histograma del área construida
hist(aptos$areaconst, main = "Histograma de área construida", xlab = "Área construida", col ="green")
```

Como se puede apreciar, ambos histogramas revelan que los datos tanto del precio como del área construida presentan una distribución no normal, con un sesgo hacia la derecha. 

Para corroborar esta no normalidad, se aplicó la prueba estadística de Shapiro-Wilk a ambas variables.

```{r}
library(stats)
shapiro.test(aptos$preciom)
shapiro.test(aptos$areaconst)
```

De lo anterior, es posible verficar que los p-valores son menores a 0.05, por lo cual, la hipótesis nula se rechaza y confirmando que las dos variables sigue una distribución normal.


### 1.2 Análisis para Apartamentos

```{r}
casas <- subset(vivienda4, vivienda4$tipo == "Casa")
summary(casas)
```
Por el lado de las casas, al ver el resumen del dataframe se destaca lo siguiente: 

- Las casas son de estrato 4 y presentan precios que varían entre 221.3 millones y 302.3 millones, con un promedio de 265.7 millones. 
- El 50% de las casas tiene precios que oscilan entre 250.4 y 284.1 millones, mientras que un 25% cuesta menos de 250.4 millones y el otro 25% supera los 284.1 millones.

- En cuanto al área construida, las casas van desde 54 m² hasta 200 m², con una media de 135.9 m². - La mitad de las casas tiene un área construida que oscila entre 100 y 170 m².
- Un 25% de las casas tiene menos de 100 m², mientras que otro 25% supera los 170 m².

```{r}
par(mfrow = c(1, 2))
boxplot(casas$preciom, main = "Precio de casas", col = "#54FF9F")
boxplot(casas$areaconst, main = "Área construida de casas", col ="#F0E68C")
par(mfrow = c(1, 1))
```
Como se puede observar en el gráfico de cajas anterior, tanto el precio como el área construida muestran una cierta simetría en sus datos, sin evidencia de valores atípicos. 

```{r}
par(mfrow = c(1, 2))
hist(casas$preciom, main = "Histograma de precio", xlab = "Precio", col = "#54FF9F")
hist(casas$areaconst, main = "Histograma de área construida", xlab = "Área construida", col ="#F0E68C")
par(mfrow = c(1, 1))
```

No obstante, el histograma revela que los datos no siguen una distribución normal para ambas variables. Para confirmar esta no normalidad, se aplica la prueba estadística de Shapiro-Wilk.

```{r}
shapiro.test(casas$preciom)
shapiro.test(casas$areaconst)
```

El test anterior muestra p-valores menores a 0.05. lo que permite rechazar la hipótesis nula, afirmando así que ninguna de las dos variables presenta una distribución normal.

# **2. Realice un análisis exploratorio bivariado de datos, enfocado en la relación entre la variable respuesta (precio) en función de la variable predictora (area construida) - incluir gráficos e indicadores apropiados interpretados.**

```{r}
# Gráfico de dispersión (precio vs área construida) con línea de tendencia central
ggplot(vivienda4, aes(x = areaconst, y = preciom)) +
  geom_point() +
  geom_smooth(method = "lm", color = "red", se = FALSE) +  # Línea de tendencia
  labs(x = "Área Construida (m²)", y = "Precio (millones de pesos COP)") +
  ggtitle("Gráfico de Dispersión Precio vs Área Construida")
```

El gráfico de dispersión sugiere una relación lineal entre las dos variables, mostrando que a medida que aumenta el área construida, también lo hace el precio de los apartamentos. Para confirmar esta relación positiva, se aplicaremos la prueba no paramétrica de Spearman, debido a la distribución no normal de los datos.

```{r}
cor.test(aptos$areaconst, aptos$preciom)
cor.test(aptos$areaconst, aptos$preciom, method = "spearman")
```

Con base en lo anterior, el test de Pearson arroja una correlación positiva de 0.83, mientras que la prueba no paramétrica de Spearman muestra un coeficiente de 0.738. De esto, podemos inferir que: 

- Ambos resultados confirman una correlación positiva con un buen ajuste, siendo estadísticamente significativa con un p-value < 2.2e-16. 
- Este resultado indica una elasticidad unitaria entre las variables, dado que a medida que aumenta el área construida, también aumenta el precio, y esta relación es muy fuerte, como lo evidencia el valor pequeño del p-value .

# **3. Estime el modelo de regresión lineal simple entre precio=f(area)+ε. Interprete los coeficientes del modelo β0, β1 en caso de ser correcto.**


```{r}
# Estimar el modelo de regresión lineal simple
#modelo_regresion <- lm(preciom ~ areaconst, data = vivienda4)

# Mostrar un resumen del modelo
#summary(modelo_regresion)

```

#### **Para los apartamentos**

```{r}
modelo_regresion1 <- lm(aptos$preciom~aptos$areaconst)
resultado_prueba1 <- summary(modelo_regresion1)
resultado_prueba1

# Mostrar un resumen del modelo
summary(resultado_prueba1)

```

El coeficiente del intercepto (β0) en el modelo de regresión lineal es de 200.2 millones de pesos COP. Sin embargo, su interpretación en este contexto puede carecer de significado práctico, porque este valor hace referencia al precio estimado cuando el área construida es igual a cero, lo cual no tiene una interpretación realista en el contexto de bienes raíces. 

Por otro lado, el coeficiente de la variable “areaconst” (β1) es de 0.4962, lo que significa que por cada metro cuadrado adicional de área construida, se espera un incremento promedio en el precio de 0.4962 millones de pesos COP, es decir, que el precio promedio de una vivienda de tipo apartamento aumenta en aproximadamente 0.4962 millones de pesos COP por cada metro cuadrado adicional de área construida. 

#### **Para las casas**
```{r}
modelo_regresionCasas = lm (preciom ~ areaconst, casas)
summary(modelo_regresionCasas)
```

Para este caso, el coeficiente del intercepto β0 es de 200.19, lo que indica el precio del terreno sin área construida en millones de pesos COP. Además, el coeficiente R2 tiene un valor de 0.8659, lo que significa que el modelo cuenta con un 87% aprox. de la variación del precio, teniendo en cuenta el área de la casa.

Por el lado de la pendiente β1, presenta un valor de 0.49093, indicando que por cada aumento de un metro cuadrado de las casas el precio se incrementa en 0.49093 Millones. Adicionalmente, el valor de P es de <2e-16, lo que nos indica su significancia.


# **4. Construir un intervalo de confianza (95%) para el coeficiente β1, interpretar y concluir si el coeficiente es igual a cero o no. Compare este resultado con una prueba de hipótesis t.**

#### Análisis para los apartamentos

```{r}
intervalo_confianza <-confint(modelo_regresion1, level = 0.95)
intervalo_confianza
```

Determinando el intervalo de confianza del 95%, se puede inferir que por cada metro cuadrado adicional en el apartamento, el valor promedio de la variable endógena, el precio, aumentaría entre 
el 0.478 y 0.51 millones de pesos.

Para verificar este resultado mediante una prueba de hipótesis, se utiliza la prueba t para β1, con el objetivo de determinar si el coeficiente es igual a cero. 

La hipótesis nula plantea que β1 = 0, lo que implicaría que no existe una relación lineal entre el precio (variable endógena) y el área construida (variable exógena).

```{r}
valor_p <- resultado_prueba1$coefficients["aptos$areaconst", "Pr(>|t|)"]
valor_p
```
Dado que el valor p es menor que el nivel de significancia, se rechaza la hipótesis nula y se concluye que existe una relación lineal significativa entre los metros cuadrados de los apartamentos y su precio. Esto indica que la variable exógena, el área construida, efectivamente contribuye a explicar las variaciones en la variable endógena, el precio.


#### Análisis para las casas
```{r}
intervalo_confianza <-confint(modelo_regresionCasas, level = 0.95)
intervalo_confianza
```

Con un nivel de confianza del 95%, se puede concluir que por cada metro cuadrado adicional que se incremente en la casa, el precio podría aumentar entre 0.46 y 0.51 millones de pesos.

# **5. Calcule e interprete el indicador de bondad R².**

```{r}
r_cuadrado <- summary(modelo_regresion1)$r.squared
r_cuadrado
```
Sabemos que el coeficiente de determinación (R²) es un indicador fundamental en análisis de regresión que mide la proporción de la variabilidad en la variable de respuesta (en este caso, el precio de las viviendas) que puede ser explicada por el modelo de regresión lineal simple con el área construida como variable predictora.

En este análisis, el valor de R² es igual a 0.6901162, lo que indica que aproximadamente el 69% de la variabilidad en los precios de las viviendas está explicada por la relación lineal con el área construida. Es decir, más de la mitad de la variación en los precios de las viviendas puede atribuirse al tamaño del área construida según el modelo. Sin embargo, el 31% restante de la variación en los precios no puede ser explicada por el área construida y podría estar influenciada por otras variables o factores externos al modelo.

# **6. Predicción de precio de apartamentos.**
# **¿Cuál sería el precio promedio estimado para un apartamento de 110 metros cuadrados? Considera entonces con este resultado que un apartamento en la misma zona con 110 metros cuadrados en un precio de 200 millones sería una atractiva oferta? ¿Qué consideraciones adicionales se deben tener?.**


